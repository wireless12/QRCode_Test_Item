<template>
  <div class="home">
    <div style="text-align: center;">
      <svg style="width: 60px;" t="1709777700453" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2483" width="200" height="200"><path d="M1022.588147 511.294073c0-282.916054-228.378019-511.294073-511.294074-511.294073S0 228.378019 0 511.294073s228.378019 511.294073 511.294073 511.294074c20.451763 0 44.312153-3.408627 64.763916-3.408628 34.086272 3.408627 74.989797 6.817254 115.893324 3.408628 132.936459-3.408627 228.378019-34.086272 286.324681-57.946662-37.494899-6.817254-92.032933-20.451763-153.388222-47.72078C944.189722 821.479144 1022.588147 674.908177 1022.588147 511.294073zM255.647037 426.078394c0-37.494899 30.677644-68.172543 68.172543-68.172543s68.172543 30.677644 68.172543 68.172543-30.677644 68.172543-68.172543 68.172544-68.172543-30.677644-68.172543-68.172544zM756.715229 681.725431c-44.312153 85.215679-129.527832 136.345086-228.37802 136.345086-95.44156 0-180.657239-51.129407-224.969392-136.345086-3.408627-6.817254 0-17.043136 6.817254-23.86039 6.817254-3.408627 17.043136 0 23.86039 6.817254 37.494899 71.58117 112.484696 119.30195 197.700375 119.301951 81.807052 0 156.796849-44.312153 197.700375-119.301951 3.408627-6.817254 13.634509-10.225881 23.86039-6.817254 3.408627 3.408627 6.817254 13.634509 3.408628 23.86039z m10.225881-177.248612l-190.883121-47.72078c-3.408627 0-3.408627-3.408627-6.817254-3.408627 0 0 0-3.408627-3.408627-3.408627v-3.408628-6.817254c0-6.817254 3.408627-10.225881 6.817254-13.634509L749.897974 330.636834c6.817254-3.408627 13.634509 0 17.043136 10.225882s0 17.043136-6.817254 23.86039l-136.345087 71.58117 146.570968 37.494899c6.817254 3.408627 13.634509 10.225881 10.225882 20.451763 0 6.817254-6.817254 13.634509-13.634509 10.225881z" fill="#ffffff" p-id="2484"></path></svg>
    </div>
    <div style="text-align: center;">
      <svg style="width: 240px;" t="1709887264912" class="icon" viewBox="0 0 1445 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16070" width="200" height="200"><path d="M1312.264059 852.825304V67.860605a67.747241 67.747241 0 0 0-67.747241-67.747241h-200.757658a21.453293 21.453293 0 1 0 0 42.680762h201.660954A24.389007 24.389007 0 0 1 1269.809121 67.860605v784.964699zM174.787882 852.825304V67.860605a24.389007 24.389007 0 0 1 24.389007-25.066479h759.220748a21.227469 21.227469 0 0 0 21.227468-21.453293 21.227469 21.227469 0 0 0-21.227468-21.227469H199.176889a67.747241 67.747241 0 0 0-67.747241 67.747241v784.964699z" p-id="16071" fill="#ffffff"></path><path d="M1219.450339 152.318832a59.843396 59.843396 0 0 0-59.843396-59.843396H284.538412A59.843396 59.843396 0 0 0 225.824137 152.318832v607.466928a59.843396 59.843396 0 0 0 59.843396 59.843396h874.165234A59.843396 59.843396 0 0 0 1219.450339 759.78576z m-42.680762 607.466928a17.388459 17.388459 0 0 1-17.162634 17.162634H284.538412a17.388459 17.388459 0 0 1-17.162634-17.162634V152.318832A17.388459 17.388459 0 0 1 284.538412 135.607846h875.294355a17.388459 17.388459 0 0 1 17.162634 17.162634zM1359.235479 851.922008H86.038996A86.26482 86.26482 0 0 0 0 937.961004a86.26482 86.26482 0 0 0 86.038996 86.038996h194.208758a20.098348 20.098348 0 0 0 18.291755-19.872524 19.872524 19.872524 0 0 0-19.6467-19.872524H90.329655a46.519772 46.519772 0 1 1 0-93.039544h1266.873407a46.519772 46.519772 0 0 1 0 93.039544H413.032346a19.872524 19.872524 0 0 0 0 39.745048h946.203133A86.26482 86.26482 0 0 0 1445.274476 937.961004a86.26482 86.26482 0 0 0-86.038997-86.038996z" p-id="16072" fill="#ffffff"></path><path d="M319.992802 180.546849m10.613734 0l209.338975 0q10.613734 0 10.613735 10.613734l0 21.453293q0 10.613734-10.613735 10.613735l-209.338975 0q-10.613734 0-10.613734-10.613735l0-21.453293q0-10.613734 10.613734-10.613734Z" p-id="16073" fill="#ffffff"></path><path d="M319.992802 271.102328m10.613734 0l495.458156 0q10.613734 0 10.613735 10.613734l0 21.453293q0 10.613734-10.613735 10.613735l-495.458156 0q-10.613734 0-10.613734-10.613735l0-21.453293q0-10.613734 10.613734-10.613734Z" p-id="16074" fill="#ffffff"></path><path d="M319.992802 361.431983m10.613734 0l611.305939 0q10.613734 0 10.613734 10.613734l0 21.453293q0 10.613734-10.613734 10.613734l-611.305939 0q-10.613734 0-10.613734-10.613734l0-21.453293q0-10.613734 10.613734-10.613734Z" p-id="16075" fill="#ffffff"></path><path d="M319.992802 451.987461m10.613734 0l380.739495 0q10.613734 0 10.613734 10.613735l0 21.453293q0 10.613734-10.613734 10.613734l-380.739495 0q-10.613734 0-10.613734-10.613734l0-21.453293q0-10.613734 10.613734-10.613735Z" p-id="16076" fill="#ffffff"></path><path d="M319.992802 542.54294m10.613734 0l532.719139 0q10.613734 0 10.613734 10.613735l0 21.453293q0 10.613734-10.613734 10.613734l-532.719139 0q-10.613734 0-10.613734-10.613734l0-21.453293q0-10.613734 10.613734-10.613735Z" p-id="16077" fill="#ffffff"></path><path d="M319.992802 633.098419m10.613734 0l61.875814 0q10.613734 0 10.613734 10.613735l0 21.453293q0 10.613734-10.613734 10.613734l-61.875814 0q-10.613734 0-10.613734-10.613734l0-21.453293q0-10.613734 10.613734-10.613735Z" p-id="16078" fill="#ffffff"></path></svg>
      <div style="color: white;font-size: 20px;">
        <p>电脑网页端扫码登陆</p>
        地点:{{ loginAddress }}
      </div>
    </div>
    <div style="text-align: center;margin-top: 20px;">
      <Button @click="sendMethod()" shape="circle" type="dashed" ghost icon="md-play" style="font-size: 30px;height: 55px;" size="large" v-width="250">确认登陆</Button>
    </div>
    
  </div>
</template>

<script setup>
import { reactive, inject, onMounted, onDeactivated, ref } from 'vue'
import router from '@/router/index'
onMounted(() => {
  loginId.value = localStorage.getItem('loginId')
  loginAddress.value = localStorage.getItem('loginAddress')
  localStorage.removeItem('loginAddress')
  localStorage.removeItem('loginId')
  path.value= `ws://192.168.100.47:8089/websocket/id-${generateRandomString(8)}`
  //ws初始化
  initMethod()
})
const generateRandomString = (length) => {
  const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  return Array.from({ length })
    .reduce((result) => result + characters.charAt(Math.floor(Math.random() * characters.length)), '');
}
const loginAddress = ref('')
const loginId = ref('')
const confirmLogin = () => {
  router.push('./mobileIndex')
}
//websocket相关变量
const path = ref('')
const socket = reactive({ data: {} })
const initMethod = () => {
  if (typeof (WebSocket) === 'undefined') {
    alert('您的浏览器不支持socket')
  } else {
    // 实例化socket
    socket.data = new WebSocket(path.value)
    // 监听socket连接
    socket.data.onopen = openMethod
    // 监听socket错误信息
    socket.data.onerror = errorMethod
    // 监听socket消息
    socket.data.onmessage = getMessageMethod
  }
}
const openMethod = () => {
  console.log('socket连接成功')
}
const errorMethod = () => {
  console.log('连接错误')
}
const getMessageMethod = (msg) => {
  if(msg.data==='200') {
    confirmLogin()
  }
}
const sendMethod = () => {
  let param = `${loginId.value}&&&&${localStorage.getItem('userToken')}`
  socket.data.send(param)
}
</script>

<style scoped>
.home{
  width: 100%;
  height: 100vh;
  background: linear-gradient(-65deg, #aeff78, #ffb0cd, #359dc4, #ff5e00);
  background-size: 200% 200%;
  animation: bgcolor 3s ease-in-out infinite;
}
</style>